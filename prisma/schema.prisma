generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

type OrdersCustomer {
  email    String
  fullname String
  phone    String
  address  String
  province String
  district String
  ward     String
}

type OrdersProducts {
  quantity Int
  discount Int
  id       String
  image    String
  name     String
  price    Float
}

model users {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  role      Role      @default(USER)
  email     String
  username  String    @default(cuid())
  phone     String?
  fullname  String
  addresses address[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([username, email, phone])
  @@index([email], name: "email")
}

model address {
  id        String         @id @default(auto()) @map("_id") @db.ObjectId
  customer  OrdersCustomer
  isDefault Boolean?       @default(false)
  users     users?         @relation(fields: [usersId], references: [id])
  usersId   String?        @db.ObjectId

  @@unique([usersId, isDefault])
}

model categories {
  id       String     @id @default(auto()) @map("_id") @db.ObjectId
  isActive Boolean    @default(true)
  category String
  title    String
  image    String
  products products[]

  @@unique([category, title])
}

model products {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  categories  categories @relation(fields: [category], references: [id])
  category    String     @db.ObjectId
  images      Json[]
  name        String
  description String
  price       Float
  discount    Int
  quantity    Int
  sold        Int
  ranking     Float
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@unique([category, name])
}

model orders {
  id          String           @id @default(auto()) @map("_id") @db.ObjectId
  customer    OrdersCustomer
  orderID     String
  order_date  String
  products    OrdersProducts[]
  status      Int
  total_price Int
  username    String
}

enum Role {
  ADMIN
  USER
}

enum OrderStatus {
  PENDING
  CONFIRMED
  SHIPPING
  DELIVERED
  CANCELLED
}
